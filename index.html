<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photoshop Web Editor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <style>
        :root {
            --dark-bg: #2d2d2d;
            --panel-bg: #3d3d3d;
            --toolbar-bg: #252525;
            --active-color: #0078d7;
        }
        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background: var(--dark-bg);
            color: white;
            height: 100vh;
            display: grid;
            grid-template-columns: 50px auto 200px;
            grid-template-rows: 40px auto 150px;
            overflow: hidden;
        }
        .menu-bar {
            grid-column: 1 / span 3;
            background: var(--toolbar-bg);
            display: flex;
            padding: 0 10px;
            border-bottom: 1px solid #1a1a1a;
        }
        .menu-bar span {
            padding: 10px 15px;
            cursor: pointer;
        }
        .menu-bar span:hover {
            background: #4d4d4d;
        }
        .tool-panel {
            background: var(--toolbar-bg);
            padding: 10px 5px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            border-right: 1px solid #1a1a1a;
        }
        .tool-panel button {
            background: transparent;
            border: none;
            color: white;
            font-size: 20px;
            padding: 8px;
            border-radius: 3px;
            cursor: pointer;
        }
        .tool-panel button:hover {
            background: #4d4d4d;
        }
        .tool-panel button.active {
            background: var(--active-color);
        }
        .canvas-container {
            position: relative;
            overflow: auto;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #545454;
        }
        #canvas {
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            background: white;
        }
        .right-panel {
            background: var(--panel-bg);
            border-left: 1px solid #1a1a1a;
            display: flex;
            flex-direction: column;
        }
        .panel-tabs {
            display: flex;
            border-bottom: 1px solid #1a1a1a;
        }
        .panel-tabs button {
            flex: 1;
            background: transparent;
            border: none;
            color: #ccc;
            padding: 8px;
            cursor: pointer;
        }
        .panel-tabs button.active {
            background: var(--panel-bg);
            color: white;
            border-bottom: 2px solid var(--active-color);
        }
        .panel-content {
            flex: 1;
            overflow: auto;
            padding: 10px;
        }
        .layers-list {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .layer-item {
            background: #4d4d4d;
            padding: 8px;
            border-radius: 3px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        .layer-item.active {
            background: var(--active-color);
        }
        .status-bar {
            grid-column: 1 / span 3;
            background: var(--toolbar-bg);
            display: flex;
            align-items: center;
            padding: 0 10px;
            border-top: 1px solid #1a1a1a;
            font-size: 12px;
        }
        .tool-options {
            position: absolute;
            top: 45px;
            left: 60px;
            background: var(--toolbar-bg);
            padding: 5px 10px;
            border-radius: 0 0 3px 3px;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .color-box {
            width: 30px;
            height: 30px;
            border: 2px solid white;
            cursor: pointer;
        }
        .menu-dropdown {
            position: absolute;
            background: #3d3d3d;
            min-width: 150px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            z-index: 1;
        }
        .menu-dropdown div {
            padding: 8px 16px;
            cursor: pointer;
        }
        .menu-dropdown div:hover {
            background: #4d4d4d;
        }
    </style>
</head>
<body>
    <!-- Photoshop-like UI -->
    <div class="menu-bar">
        <span id="file-menu">File</span>
        <span>Edit</span>
        <span>Image</span>
        <span>Layer</span>
        <span>Select</span>
        <span>Filter</span>
        <span>View</span>
        <span>Window</span>
        <span>Help</span>
    </div>

    <!-- Left Tool Panel -->
    <div class="tool-panel">
        <button id="move-tool" title="Move Tool (V)" class="active">↔</button>
        <button id="selection-tool" title="Selection Tool (M)">□</button>
        <button id="crop-tool" title="Crop Tool (C)">✂</button>
        <button id="brush-tool" title="Brush Tool (B)">🖌</button>
        <button id="text-tool" title="Text Tool (T)">T</button>
        <button id="upload-tool" title="Upload Image">📁</button>
        <div style="display: flex; gap: 5px; margin-top: 10px;">
            <div id="foreground-color" class="color-box" style="background: #000000;"></div>
            <div id="background-color" class="color-box" style="background: #ffffff;"></div>
        </div>
    </div>

    <!-- Main Canvas -->
    <div class="canvas-container">
        <canvas id="canvas" width="800" height="600"></canvas>
        <div class="tool-options" id="tool-options"></div>
    </div>

    <!-- Right Panel -->
    <div class="right-panel">
        <div class="panel-tabs">
            <button class="active" data-panel="layers">Layers</button>
            <button data-panel="history">History</button>
        </div>
        <div class="panel-content">
            <div id="layers-panel" class="panel-section">
                <div class="layers-list" id="layers-list"></div>
                <button id="add-layer" style="margin-top: 10px; width: 100%;">+ Add Layer</button>
            </div>
            <div id="history-panel" class="panel-section" style="display: none;">
                <div id="history-list"></div>
            </div>
        </div>
    </div>

    <!-- Status Bar -->
    <div class="status-bar">
        <span>Document: 800 × 600 px</span>
        <span style="margin-left: auto;">Ready</span>
    </div>

    <!-- Hidden File Input -->
    <input type="file" id="file-input" accept="image/*" style="display: none;">

    <script>
        // Initialize Canvas
        const canvas = new fabric.Canvas('canvas', {
            preserveObjectStacking: true,
            selection: true
        });

        // App State
        const state = {
            activeTool: 'move',
            history: [],
            historyIndex: -1,
            maxHistory: 50
        };

        // File Menu Functionality
        document.getElementById('file-menu').addEventListener('click', function(e) {
            e.stopPropagation();
            const dropdown = document.createElement('div');
            dropdown.className = 'menu-dropdown';
            dropdown.innerHTML = `
                <div onclick="document.getElementById('file-input').click()">Open...</div>
                <div onclick="saveImage()">Save</div>
                <div onclick="window.print()">Print</div>
            `;
            dropdown.style.left = this.offsetLeft + 'px';
            dropdown.style.top = '40px';
            
            document.body.appendChild(dropdown);
            
            // Close when clicking elsewhere
            const closeMenu = function() {
                document.body.removeChild(dropdown);
                document.removeEventListener('click', closeMenu);
            };
            setTimeout(() => document.addEventListener('click', closeMenu), 10);
        });

        // Upload Functionality
        document.getElementById('upload-tool').addEventListener('click', function() {
            document.getElementById('file-input').click();
        });

        document.getElementById('file-input').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(event) {
                fabric.Image.fromURL(event.target.result, function(img) {
                    img.set({
                        left: canvas.width / 2 - img.width / 2,
                        top: canvas.height / 2 - img.height / 2,
                        selectable: true,
                        name: 'Image Layer'
                    });
                    canvas.add(img);
                    saveState();
                    updateLayersPanel();
                });
            };
            reader.readAsDataURL(file);
        });

        // Core Functions
        function saveImage() {
            const link = document.createElement('a');
            link.download = 'design.png';
            link.href = canvas.toDataURL({ format: 'png', quality: 1 });
            link.click();
        }

        function addNewLayer() {
            const layer = new fabric.Rect({
                width: 100,
                height: 100,
                fill: 'rgba(0,0,255,0.5)',
                left: 100,
                top: 100,
                selectable: true,
                name: 'New Layer'
            });
            canvas.add(layer);
            saveState();
            updateLayersPanel();
        }

        function saveState() {
            if (state.historyIndex < state.history.length - 1) {
                state.history = state.history.slice(0, state.historyIndex + 1);
            }
            state.history.push(JSON.stringify(canvas));
            state.historyIndex++;
            if (state.history.length > state.maxHistory) {
                state.history.shift();
                state.historyIndex--;
            }
            updateHistoryPanel();
        }

        function updateLayersPanel() {
            const layersList = document.getElementById('layers-list');
            layersList.innerHTML = '';

            canvas.getObjects().forEach((obj, index) => {
                const layerItem = document.createElement('div');
                layerItem.className = 'layer-item';
                if (obj === canvas.getActiveObject()) {
                    layerItem.classList.add('active');
                }
                layerItem.innerHTML = `
                    <span>${obj.name || 'Layer ' + (index + 1)}</span>
                `;
                layerItem.addEventListener('click', () => {
                    canvas.setActiveObject(obj);
                    canvas.renderAll();
                    updateLayersPanel();
                });
                layersList.appendChild(layerItem);
            });
        }

        function updateHistoryPanel() {
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = '';

            state.history.forEach((state, index) => {
                const historyItem = document.createElement('div');
                historyItem.textContent = `Action ${index + 1}`;
                historyItem.style.padding = '5px';
                historyItem.style.cursor = 'pointer';
                historyItem.style.borderBottom = '1px solid #4d4d4d';

                if (index === state.historyIndex) {
                    historyItem.style.background = '#4d4d4d';
                }

                historyItem.addEventListener('click', () => {
                    state.historyIndex = index;
                    canvas.loadFromJSON(state, () => {
                        canvas.renderAll();
                        updateLayersPanel();
                    });
                    updateHistoryPanel();
                });

                historyList.appendChild(historyItem);
            });
        }

        // Initialize
        document.getElementById('add-layer').addEventListener('click', addNewLayer);
        addNewLayer(); // Add default layer
    </script>
</body>
</html>
